<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPE2024</title>

    <!-- Bootstrap Script -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"
        integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD"
        crossorigin="anonymous"></script>

    <!-- Bootstrap Style -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" />
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.9.96/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

    <!-- Fetch Data -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.1/axios.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-body-tertiary mb-3">
        <div class="container-fluid ms-5 me-5">
            <a href="#" class="navbar-brand fs-3 fw-bold text-danger mb-0">IPE<span class="text-body">2024</span></a>
            <button id="tema" onclick="aturTema()" class="btn text-body mdi mdi-weather-night"></button>
        </div>
    </nav>

    <!-- Container -->
    <div class="ms-3 me-3 p-3">
        <div id="pemilih" class="mb-3 text-center w-100"></div>

        <div class="alert alert-info" style="text-align: justify;">
            Selamat datang di IPE2024 (Indonesian Presidential Election 2024), tempat di mana Anda dapat menjelajahi
            spekulasi hasil suara pemilihan presiden Indonesia tahun 2024. Harap diingat, semua informasi yang disajikan
            di sini hanya bersifat opini dan analisis, bukan prediksi resmi. Kami mengharapkan Anda untuk menggunakan
            informasi ini dengan bijak dan untuk kepentingan informasi dan hiburan semata.
        </div>

        <div class="mt-5 mb-5 border-top"></div>

        <section id="pilihan" class="row text-center">
            <h1 class="text-center mb-3">Kotak Pilihan</h1>

            <div class="col-md-4">
                <button type="button" id="card01" class="btn" data-bs-toggle="modal" data-bs-target="#modal01">
                    <div class="card w-100 ms-1 me-1 mb-3 text-body">
                        <div class="d-flex">
                            <img src="https://framerusercontent.com/images/EeXC5h6iOkyHcbWs7ui6Lcf3kNM.webp"
                                class="foto-capres w-50">
                            <img src="https://framerusercontent.com/images/CAS8PIX2K6bHflQw4xJohFYwpYo.webp"
                                class="foto-cawapres w-50">
                        </div>
                        <div class="card-body">
                            <p class="card-title fs-4 fw-bold">Anies Baswedan &<br />Muhaimin Iskandar</p>
                            <p class="card-text">Calon Presiden dan Wakil Presiden No. 01</p>
                        </div>
                    </div>
            </div>
            </button>
            <div class="modal fade" id="modal01">
                <div class="modal-dialog">
                    <form class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">Kenapa Pilih Paslon 01?</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <textarea class="form-control" id="sentimen01" rows="3"
                                placeholder="Saya memilih Paslon 01 karena..." required></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-sm btn-danger" data-bs-dismiss="modal">Gak
                                Jadi</button>
                            <button type="button" class="btn btn-sm btn-primary ms-auto" id="paslon01" disabled>Pilih 01</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="col-md-4">
                <button type="button" id="card02" class="btn" data-bs-toggle="modal" data-bs-target="#modal02">
                    <div class="card w-100 ms-1 me-1 mb-3 text-body">
                        <div class="d-flex">
                            <img src="https://framerusercontent.com/images/dwzSLTtnVy63Kk8oqLwNQjk6GoE.webp"
                                class="foto-capres w-50">
                            <img src="https://framerusercontent.com/images/qJZW5XYulQcj5AM1YWp4BRmA.webp"
                                class="foto-cawapres w-50">
                        </div>
                        <div class="card-body">
                            <p class="card-title fs-4 fw-bold">Prabowo Subianto &<br />Gibran Rakabuming</p>
                            <p class="card-text">Calon Presiden dan Wakil Presiden No. 02</p>
                        </div>
                    </div>
            </div>
            </button>
            <div class="modal fade" id="modal02">
                <div class="modal-dialog">
                    <form class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">Kenapa Pilih Paslon 02?</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <textarea class="form-control" id="sentimen02" rows="3"
                                placeholder="Saya memilih Paslon 02 karena..." required></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-sm btn-danger" data-bs-dismiss="modal">Gak
                                Jadi</button>
                            <button type="button" class="btn btn-sm btn-primary ms-auto" id="paslon02" disabled>Pilih 02</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="col-md-4">
                <button type="button" id="card03" class="btn" data-bs-toggle="modal" data-bs-target="#modal03">
                    <div class="card w-100 ms-1 me-1 mb-3 text-body">
                        <div class="d-flex">
                            <img src="https://framerusercontent.com/images/DTjFPFr3sp9pNXGVibTRH6Kk.webp"
                                class="foto-capres w-50">
                            <img src="https://framerusercontent.com/images/u8aFsm0ZEUKNYoTPtMXEu7mZ0dQ.webp"
                                class="foto-cawapres w-50">
                        </div>
                        <div class="card-body">
                            <p class="card-title fs-4 fw-bold">Ganjar Pranowo &<br />Mahfud MD</p>
                            <p class="card-text">Calon Presiden dan Wakil Presiden No. 03</p>
                        </div>
                    </div>
            </div>
            </button>
            <div class="modal fade" id="modal03">
                <div class="modal-dialog">
                    <form class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">Kenapa Pilih Paslon 03?</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <textarea class="form-control" id="sentimen03" rows="3"
                                placeholder="Saya memilih Paslon 03 karena..." required></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-sm btn-danger" data-bs-dismiss="modal">Gak
                                Jadi</button>
                            <button type="button" class="btn btn-sm btn-primary ms-auto" id="paslon03" disabled>Pilih 03</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="mt-3 text-center">
                <span>Yuk kenalan lebih dalam sama ketiga Paslon dan melek politik bersama</span><br />

                <a href="https://www.bijakmemilih.id/profil-kandidat" target="_blank" class="w-50">
                    <img width="200px" class="bijakmemilih" id="bijakmemilih"
                        src="https://framerusercontent.com/images/g243IrDgkcrmrzEKfhhXv58gO8.png">
                </a>

            </div>
        </section>

        <div class="mt-5 mb-5 border-top"></div>

        <section id="perolehan" class="w-100 text-center mb-5">
            <h1 class="mb-3">Perolehan Pilihan</h1>
            <div class="w-100 ms-auto me-auto">
                <canvas id="grafik"></canvas>
            </div>
        </section>

        <div class="mt-5 mb-5 border-top"></div>

        <section id="alasan" class="row text-center mb-5">
            <h1 class="mb-3">Alasan Pemilih</h1>
            <div class="col-md-4">
                <div class="card p-3 ms-1 me-1 mb-3">
                    <h5>Anies Baswedan &<br />Muhaimin Iskandar</h5>
                    <ul class="list-group list-group-flush mt-3" id="list01"></ul>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card p-3 ms-1 me-1 mb-3">
                    <h5>Prabowo Subianto &<br />Gibran Rakabuming</h5>
                    <ul class="list-group list-group-flush mt-3" id="list02"></ul>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card p-3 ms-1 me-1 mb-3">
                    <h5>Ganjar Pranowo &<br />Mahfud MD</h5>
                    <ul class="list-group list-group-flush mt-3" id="list03"></ul>
                </div>
            </div>
        </section>
    </div>
</body>

<footer class="bg-body-tertiary p-3 text-center">
    habilihsanproject © 2024
</footer>

</html>

<script src="./database.js"></script>
<script>
    // Theme
    let tema = document.getElementById("tema").classList
    let bijakmemilih = document.getElementById("bijakmemilih").classList
    function aturTema() {
        let data = document.getElementsByTagName("html")[0].dataset.bsTheme
        if (data == "dark") {
            document.getElementsByTagName("html")[0].dataset.bsTheme = "undefined"
            tema.replace("mdi-weather-night", "mdi-weather-sunny")
            bijakmemilih.remove("bijakmemilih")
            localStorage.setItem("theme", "undefined")
        }
        if (data == "undefined") {
            document.getElementsByTagName("html")[0].dataset.bsTheme = "dark"
            tema.replace("mdi-weather-sunny", "mdi-weather-night")
            bijakmemilih.add("bijakmemilih")
            localStorage.setItem("theme", "dark")
        }
    }

    // Database
    let IPpemilih = []
    function dataPemilihan() {
        const data01 = firebase.firestore().collection("IPE2024").doc("paslon01")
        data01.get().then((doc) => {
            const pemilih = doc.data().data
            localStorage.setItem("data01", pemilih.length)

            for (let i = 0; i < pemilih.length; i++) {
                IPpemilih.push(pemilih[i].ip)
            }

            const sentimen = pemilih.map(item => item.sentimen)
            const list = document.querySelector("#list01")
            const datanya = data => {
                const template = document.createElement("template")
                template.innerHTML =
                    `<li class="list-group-item">${sentimen[i]}</li>`
                        .trim()
                return template.content.firstChild
            }
            for (i in sentimen) {
                list.append(datanya())
            }

            const x0 = document.getElementById("list01")
            x0.children[0].remove()
        })
        const data02 = firebase.firestore().collection("IPE2024").doc("paslon02")
        data02.get().then((doc) => {
            const pemilih = doc.data().data
            localStorage.setItem("data02", pemilih.length)

            for (let i = 0; i < pemilih.length; i++) {
                IPpemilih.push(pemilih[i].ip)
            }

            const sentimen = pemilih.map(item => item.sentimen)
            const list = document.querySelector("#list02")
            const datanya = data => {
                const template = document.createElement("template")
                template.innerHTML =
                    `<li class="list-group-item">${sentimen[i]}</li>`
                        .trim()
                return template.content.firstChild
            }
            for (i in sentimen) {
                list.append(datanya())
            }

            const x0 = document.getElementById("list02")
            x0.children[0].remove()
        })
        const data03 = firebase.firestore().collection("IPE2024").doc("paslon03")
        data03.get().then((doc) => {
            const pemilih = doc.data().data
            localStorage.setItem("data03", pemilih.length)

            for (let i = 0; i < pemilih.length; i++) {
                IPpemilih.push(pemilih[i].ip)
            }

            const sentimen = pemilih.map(item => item.sentimen)
            const list = document.querySelector("#list03")
            const datanya = data => {
                const template = document.createElement("template")
                template.innerHTML =
                    `<li class="list-group-item">${sentimen[i]}</li>`
                        .trim()
                return template.content.firstChild
            }
            for (i in sentimen) {
                list.append(datanya())
            }

            const x0 = document.getElementById("list03")
            x0.children[0].remove()
        })

        setTimeout(grafisData, 1000)
    }

    // Voter Address
    axios.get("https://api.ipify.org?format=json")
        .then(res => {
            const pemilih = document.getElementById("pemilih")
            pemilih.innerHTML = `<span>No. Pemilih:<b id="ip" class="ms-3 badge rounded-pill text-bg-secondary">${res.data.ip}</b></span><br/>
                                <span id="note" style="display: none;">Kamu sudah memilih, semoga pilihanmu menang ya!</span>`
            localStorage.setItem("ip", res.data.ip)

            const ip = localStorage.getItem("ip")
            for (let i = 0; i < IPpemilih.length; i++) {
                if (ip == IPpemilih[i]) {
                    document.getElementById("card01").disabled = true
                    document.getElementById("card02").disabled = true
                    document.getElementById("card03").disabled = true
                    document.getElementById("note").style.display = "block"
                    document.getElementById("ip").classList.replace("text-bg-secondary", "text-bg-success")
                }
            }
        })

    // Vote
    let Paslon01 = document.getElementById("paslon01")
    let sentimen01 = document.getElementById("sentimen01")

        sentimen01.addEventListener("change", function () {
           Paslon01.disabled = false;
        })

    Paslon01.addEventListener("click", () => {
        let vote = []

        const ip = localStorage.getItem("ip")
        const sentimen = sentimen01.value

        const data01 = firebase.firestore().collection("IPE2024").doc("paslon01")
        data01.get().then((doc) => {
            const voting = {
                ip: ip,
                sentimen: sentimen
            }
            vote = doc.data().data
            vote.push(voting)
            data01.update({ data: vote })
                .then(() => {
                    alert("Terimakasih sudah memilih!")
                    location.reload()
                })
        })
    })

    let Paslon02 = document.getElementById("paslon02")
    let sentimen02 = document.getElementById("sentimen02")

        sentimen02.addEventListener("change", function () {
            Paslon02.disabled = false;
        })
    
    Paslon02.addEventListener("click", () => {
        let vote = []

        const ip = localStorage.getItem("ip")
        const sentimen = sentimen02.value

        const data02 = firebase.firestore().collection("IPE2024").doc("paslon02")
        data02.get().then((doc) => {
            const voting = {
                ip: ip,
                sentimen: sentimen
            }
            vote = doc.data().data
            vote.push(voting)
            data02.update({ data: vote })
                .then(() => {
                    alert("Terimakasih sudah memilih!")
                    location.reload()
                })
        })
    })

    let Paslon03 = document.getElementById("paslon03")
    let sentimen03 = document.getElementById("sentimen03")

        sentimen03.addEventListener("change", function () {
            Paslon03.disabled = false;
        })

    Paslon03.addEventListener("click", () => {
        let vote = []

        const ip = localStorage.getItem("ip")
        const sentimen = sentimen03.value

        const data03 = firebase.firestore().collection("IPE2024").doc("paslon03")
        data03.get().then((doc) => {
            const voting = {
                ip: ip,
                sentimen: sentimen
            }
            vote = doc.data().data
            vote.push(voting)
            data03.update({ data: vote })
                .then(() => {
                    alert("Terimakasih sudah memilih!")
                    location.reload()
                })
        })
    })

    // Chart
    function grafisData() {
        const pemilih01 = Number((localStorage.getItem("data01") - 1) * 100 / (IPpemilih.length - 1))
        const pemilih02 = Number((localStorage.getItem("data02") - 1) * 100 / (IPpemilih.length - 1))
        const pemilih03 = Number((localStorage.getItem("data03") - 1) * 100 / (IPpemilih.length - 1))

        const labels = ["Paslon 01", "Paslon 02", "Paslon 03"]
        const data = [pemilih01, pemilih02, pemilih03]
        const ctx = document.getElementById("grafik").getContext("2d")
        new Chart(ctx, {
            type: "bar",
            data: {
                labels: labels,
                datasets: [{
                    label: "Data",
                    data: data,
                    backgroundColor: [
                        "rgba(150, 150, 150, 0.3)",
                        "rgba(0, 145, 245, 0.3)",
                        "rgba(200, 50, 50, 0.3)"
                    ],
                    borderColor: [
                        "rgba(150, 150, 150, 1)",
                        "rgba(0, 145, 245, 1)",
                        "rgba(200, 50, 50, 1)"
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: function (value) {
                                return value + '%'
                            }
                        }
                    }
                }
            }
        })
    }

    dataPemilihan()

</script>

<style>
    .foto-capres {
        border-top-left-radius: var(--bs-card-inner-border-radius)
    }

    .foto-cawapres {
        border-top-right-radius: var(--bs-card-inner-border-radius)
    }

    .alert {
        opacity: 1;
    }

    .btn:disabled,
    .btn:hover {
        border: 0;
    }

    .bijakmemilih {
        filter: invert(1);
    }

    footer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: -webkit-fill-available;
    }
</style>